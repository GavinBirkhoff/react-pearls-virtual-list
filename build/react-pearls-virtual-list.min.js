!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t((e=e||self).VirtualList={},e.React,e.PropTypes)}(this,function(v,O,e){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};var t,i,r,n,s,d,l,a,f,c,E=function(){return(E=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};(l=d=d||{}).AUTO="auto",l.START="start",l.CENTER="center",l.END="end",(a=v.ScrollDirection||(v.ScrollDirection={})).HORIZONTAL="horizontal",a.VERTICAL="vertical",(c=f=f||{}).OBSERVED="observed",c.REQUESTED="requested";var u=((t={})[v.ScrollDirection.VERTICAL]="scrollTop",t[v.ScrollDirection.HORIZONTAL]="scrollLeft",t),x=((i={})[v.ScrollDirection.VERTICAL]="height",i[v.ScrollDirection.HORIZONTAL]="width",i),p=((r={})[v.ScrollDirection.VERTICAL]="top",r[v.ScrollDirection.HORIZONTAL]="left",r),h=((n={})[v.ScrollDirection.VERTICAL]="marginTop",n[v.ScrollDirection.HORIZONTAL]="marginLeft",n),m=((s={})[v.ScrollDirection.VERTICAL]="marginBottom",s[v.ScrollDirection.HORIZONTAL]="marginRight",s),S=(I.prototype.updateConfig=function(e){var t=e.itemCount,o=e.itemSizeGetter,i=e.estimatedItemSize;null!=t&&(this.itemCount=t),null!=i&&(this.estimatedItemSize=i),null!=o&&(this.itemSizeGetter=o)},I.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},I.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this.itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this.itemCount);if(e>this.lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),o=t.offset+t.size,i=this.lastMeasuredIndex+1;i<=e;i++){var r=this.itemSizeGetter(i);if(null==r||isNaN(r))throw Error("Invalid size returned for index "+i+" of value "+r);this.itemSizeAndPositionData[i]={offset:o,size:r},o+=r}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]},I.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return 0<=this.lastMeasuredIndex?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},I.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},I.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,o=void 0===t?d.START:t,i=e.containerSize,r=e.currentOffset,n=e.targetIndex;if(i<=0)return 0;var s,l=this.getSizeAndPositionForIndex(n),a=l.offset,c=a-i+l.size;switch(o){case d.END:s=c;break;case d.CENTER:s=a-(i-l.size)/2;break;case d.START:s=a;break;default:s=Math.max(c,Math.min(a,r))}var f=this.getTotalSize();return Math.max(0,Math.min(f-i,s))},I.prototype.getVisibleRange=function(e){var t=e.containerSize,o=e.offset,i=e.overscanCount;if(0===this.getTotalSize())return{};var r=o+t,n=this.findNearestItem(o);if(void 0===n)throw Error("Invalid offset "+o+" specified");for(var s=this.getSizeAndPositionForIndex(n),o=s.offset+s.size,l=n;o<r&&l<this.itemCount-1;)l++,o+=this.getSizeAndPositionForIndex(l).size;return i&&(n=Math.max(0,n-i),l=Math.min(l+i,this.itemCount-1)),{start:n,stop:l}},I.prototype.resetItem=function(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)},I.prototype.findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),o=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:o,low:0,offset:e}):this.exponentialSearch({index:o,offset:e})},I.prototype.binarySearch=function(e){for(var t,o,i=e.low,r=e.high,n=e.offset;i<=r;){if(t=i+Math.floor((r-i)/2),(o=this.getSizeAndPositionForIndex(t).offset)===n)return t;o<n?i=t+1:n<o&&(r=t-1)}return 0<i?i-1:0},I.prototype.exponentialSearch=function(e){for(var t=e.index,o=e.offset,i=1;t<this.itemCount&&this.getSizeAndPositionForIndex(t).offset<o;)t+=i,i*=2;return this.binarySearch({high:Math.min(t,this.itemCount-1),low:Math.floor(t/2),offset:o})},I);function I(e){var t=e.itemCount,o=e.itemSizeGetter,i=e.estimatedItemSize;this.itemSizeGetter=o,this.itemCount=t,this.estimatedItemSize=i,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}var g,y,z,C={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},R={position:"relative",width:"100%",minHeight:"100%"},T={position:"absolute",top:0,left:0,width:"100%"},A=E(E({},T),{position:"sticky"}),D=(g=O.PureComponent,o(y=b,z=g),y.prototype=null===z?Object.create(z):(M.prototype=z.prototype,new M),b.prototype.componentDidMount=function(){var e=this.props,t=e.scrollOffset,o=e.scrollToIndex;this.rootNode.addEventListener("scroll",this.handleScroll,{passive:!0}),null!=t?this.scrollTo(t):null!=o&&this.scrollTo(this.getOffsetForIndex(o))},b.prototype.componentWillReceiveProps=function(e){var t=this.props,o=t.estimatedItemSize,i=t.itemCount,r=t.itemSize,n=t.scrollOffset,s=t.scrollToAlignment,l=t.scrollToIndex,a=e.scrollToIndex!==l||e.scrollToAlignment!==s,c=e.itemCount!==i||e.itemSize!==r||e.estimatedItemSize!==o;e.itemSize!==r&&this.listManager.updateConfig({itemSizeGetter:this.itemSizeGetter(e.itemSize)}),e.itemCount===i&&e.estimatedItemSize===o||this.listManager.updateConfig({itemCount:e.itemCount,estimatedItemSize:this.getEstimatedItemSize(e)}),c&&this.recomputeSizes(),e.scrollOffset!==n?this.setState({offset:e.scrollOffset||0,scrollChangeReason:f.REQUESTED}):"number"==typeof e.scrollToIndex&&(a||c)&&this.setState({offset:this.getOffsetForIndex(e.scrollToIndex,e.scrollToAlignment,e.itemCount),scrollChangeReason:f.REQUESTED})},b.prototype.componentDidUpdate=function(e,t){var o=this.state,i=o.offset,r=o.scrollChangeReason;t.offset!==i&&r===f.REQUESTED&&this.scrollTo(i)},b.prototype.componentWillUnmount=function(){this.rootNode.removeEventListener("scroll",this.handleScroll)},b.prototype.scrollTo=function(e){var t=this.props.scrollDirection,o=void 0===t?v.ScrollDirection.VERTICAL:t;this.rootNode[u[o]]=e},b.prototype.getOffsetForIndex=function(e,t,o){void 0===t&&(t=this.props.scrollToAlignment),void 0===o&&(o=this.props.itemCount);var i=this.props.scrollDirection,r=void 0===i?v.ScrollDirection.VERTICAL:i;return(e<0||o<=e)&&(e=0),this.listManager.getUpdatedOffsetForIndex({align:t,containerSize:this.props[x[r]],currentOffset:this.state&&this.state.offset||0,targetIndex:e})},b.prototype.recomputeSizes=function(e){void 0===e&&(e=0),this.styleCache={},this.listManager.resetItem(e)},b.prototype.render=function(){var e,t=this,o=this.props,i=(o.estimatedItemSize,o.height),r=o.overscanCount,n=void 0===r?3:r,s=o.renderItem,l=(o.itemCount,o.itemSize,o.onItemsRendered),a=(o.onScroll,o.onScrollEnd,o.scrollDirection),c=void 0===a?v.ScrollDirection.VERTICAL:a,f=(o.scrollOffset,o.scrollToIndex,o.scrollToAlignment,o.stickyIndices),d=o.style,u=o.width,p=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(o[i[r]]=e[i[r]]);return o}(o,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","onScrollEnd","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","stickyIndices","style","width"]),h=this.state.offset,m=this.listManager.getVisibleRange({containerSize:this.props[x[c]]||0,offset:h,overscanCount:n}),S=m.start,I=m.stop,g=[],y=E(E(E({},C),d),{height:i,width:u}),z=E(E({},R),((e={})[x[c]]=this.listManager.getTotalSize(),e));if(null!=f&&0!==f.length&&(f.forEach(function(e){return g.push(s({index:e,style:t.getStyle(e,!0)}))}),c===v.ScrollDirection.HORIZONTAL&&(z.display="flex")),void 0!==S&&void 0!==I){for(var T=S;T<=I;T++)null!=f&&f.includes(T)||g.push(s({index:T,style:this.getStyle(T,!1)}));"function"==typeof l&&l({startIndex:S,stopIndex:I})}return O.createElement("div",E({ref:this.getRef},p,{style:y}),O.createElement("div",{style:z},g))},b.prototype.getNodeOffset=function(){var e=this.props.scrollDirection,t=void 0===e?v.ScrollDirection.VERTICAL:e;return this.rootNode[u[t]]},b.prototype.getEstimatedItemSize=function(e){return void 0===e&&(e=this.props),e.estimatedItemSize||"number"==typeof e.itemSize&&e.itemSize||50},b.prototype.getSize=function(e,t){return"function"==typeof t?t(e):Array.isArray(t)?t[e]:t},b.prototype.getStyle=function(e,t){var o,i,r=this.styleCache[e];if(r)return r;var n=this.props.scrollDirection,s=void 0===n?v.ScrollDirection.VERTICAL:n,l=this.listManager.getSizeAndPositionForIndex(e),a=l.size,c=l.offset;return this.styleCache[e]=t?E(E({},A),((o={})[x[s]]=a,o[h[s]]=c,o[m[s]]=-(c+a),o.zIndex=1,o)):E(E({},T),((i={})[x[s]]=a,i[p[s]]=c,i))},b.defaultProps={overscanCount:3,scrollDirection:v.ScrollDirection.VERTICAL,width:"100%"},b.propTypes={estimatedItemSize:e.number,height:e.oneOfType([e.number,e.string]).isRequired,itemCount:e.number.isRequired,itemSize:e.oneOfType([e.number,e.array,e.func]).isRequired,onScroll:e.func,onScrollEnd:e.func,onItemsRendered:e.func,overscanCount:e.number,renderItem:e.func.isRequired,scrollOffset:e.number,scrollToIndex:e.number,scrollToAlignment:e.oneOf([d.AUTO,d.START,d.CENTER,d.END]),scrollDirection:e.oneOf([v.ScrollDirection.HORIZONTAL,v.ScrollDirection.VERTICAL]),stickyIndices:e.arrayOf(e.number),style:e.object,width:e.oneOfType([e.number,e.string])},b);function M(){this.constructor=y}function b(){var n=null!==g&&g.apply(this,arguments)||this;return n.itemSizeGetter=function(t){return function(e){return n.getSize(e,t)}},n.listManager=new S({itemCount:n.props.itemCount,itemSizeGetter:n.itemSizeGetter(n.props.itemSize),estimatedItemSize:n.getEstimatedItemSize()}),n.state={offset:n.props.scrollOffset||null!=n.props.scrollToIndex&&n.getOffsetForIndex(n.props.scrollToIndex)||0,scrollChangeReason:f.REQUESTED},n.styleCache={},n.timer=0,n.getRef=function(e){n.rootNode=e},n.handleScroll=function(e){var t=n.props,o=t.onScroll,i=t.onScrollEnd,r=n.getNodeOffset();r<0||n.state.offset===r||e.target!==n.rootNode||(n.setState({offset:r,scrollChangeReason:f.OBSERVED}),"function"==typeof o&&o(r,e),"function"==typeof i&&(clearTimeout(n.timer),n.timer=setTimeout(function(e){n.handleScrollEnd(r,e)},500)))},n.handleScrollEnd=function(e,t){var o=n.props.onScrollEnd,i=n.getNodeOffset(),r=n.listManager.getLastMeasuredIndex();i!==e&&(clearTimeout(n.timer),n.timer=setTimeout(function(e){n.handleScrollEnd(i,e)},300)),"function"==typeof o&&o(i,t,r)},n}v.default=D,Object.defineProperty(v,"__esModule",{value:!0})});
